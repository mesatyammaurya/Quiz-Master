{% extends "layout.html" %}
{% block title %}{{admin.name}}{% endblock %}
{% block select %}
<select class="form-select mx-1" aria-label="Default select example" name="key">
    <option selected>Select</option>
    <option value="subject">Subject</option>
    <option value="chapter">Chapter</option>
</select>
{% endblock %}
{% block action %}
<a href="/logout" class="btn btn-outline-danger me-2" role="button" aria-disabled="true">Logout</a>
{% endblock %}
{% block body %}
<div class="d-flex">
    <!-- Sidebar for admin page-->
    <div id="sidebar" class="d-flex flex-column flex-shrink-0 p-3 bg-light border-end vh-100 position-fixed"
        style="width: 250px; transition: 0.3s;">

        <button id="toggleBtn" class="btn btn-outline-info mb-3"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);">
                <path d="m8.121 12 4.94-4.939-2.122-2.122L3.879 12l7.06 7.061 2.122-2.122z"></path>
                <path d="M17.939 4.939 10.879 12l7.06 7.061 2.122-2.122L15.121 12l4.94-4.939z"></path>
            </svg></button>

        <ul class="nav flex-column">
            <li class="nav-item">
                <a href="#" class="nav-link text-dark d-flex align-items-center" data-bs-toggle="tooltip"
                    title="{{admin.name}}" data-bs-placement="right">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        style="fill: rgba(0, 0, 0, 1);">
                        <path
                            d="M7.5 6.5C7.5 8.981 9.519 11 12 11s4.5-2.019 4.5-4.5S14.481 2 12 2 7.5 4.019 7.5 6.5zM20 21h1v-1c0-3.859-3.141-7-7-7h-4c-3.86 0-7 3.141-7 7v1h17z">
                        </path>
                    </svg><span class="menu-text ms-2">{{admin.name}}</span>
                </a>
            </li>
            <!-- button for triggering add subject modal -->
            <li class="nav-item">
                <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#addSubjectModal"
                    data-bs-toggle="tooltip" title="Add Subject" data-bs-placement="right">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        style="fill: rgba(0, 0, 0, 1);">
                        <path
                            d="M6.012 18H21V4c0-1.103-.897-2-2-2H6c-1.206 0-3 .799-3 3v14c0 2.201 1.794 3 3 3h15v-2H6.012C5.55 19.988 5 19.806 5 19s.55-.988 1.012-1zM8 9h3V6h2v3h3v2h-3v3h-2v-3H8V9z">
                        </path>
                    </svg><span class="menu-text ms-2">Add Subject</span>
                </button>
            </li>
            <li class="nav-item">
                <a href="/manageUsers" class="nav-link text-dark d-flex align-items-center" data-bs-toggle="tooltip"
                    title="Manage Users" data-bs-placement="right">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        style="fill: rgba(0, 0, 0, 1);transform: scaleX(-1);">
                        <path
                            d="M20 2H8a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zm-6 2.5a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5zM19 15H9v-.25C9 12.901 11.254 11 14 11s5 1.901 5 3.75V15z">
                        </path>
                        <path d="M4 8H2v12c0 1.103.897 2 2 2h12v-2H4V8z"></path>
                    </svg> <span class="menu-text ms-2">Manage Users</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/dashboard" class="nav-link text-dark " data-bs-toggle="tooltip" title="Back to Dashboard"
                    data-bs-placement="right">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        style="fill: rgba(8, 8, 8, 1);">
                        <path d="m8.121 12 4.94-4.939-2.122-2.122L3.879 12l7.06 7.061 2.122-2.122z"></path>
                        <path d="M17.939 4.939 10.879 12l7.06 7.061 2.122-2.122L15.121 12l4.94-4.939z"></path>
                    </svg><span class="menu-text ms-2 btn-outline-danger">Back to Dashboard</span>
                </a>
            </li>
            <li class="nav-item sticky-bottom">
                <a href="/logout" class="nav-link text-danger d-flex align-items-center" data-bs-toggle="tooltip"
                    title="Logout" data-bs-placement="right">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        style="fill: rgba(237, 66, 26, 1);transform: rotate(180deg);">
                        <path
                            d="M5.002 21h14c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2h-14c-1.103 0-2 .897-2 2v6.001H10V7l6 5-6 5v-3.999H3.002V19c0 1.103.897 2 2 2z">
                        </path>
                    </svg>
                    <span class="menu-text ms-2 btn-outline-danger">Logout</span>
                </a>
            </li>
        </ul>
    </div>


    <!-- Main Content of the admin Subject page -->
    <div id="mainContent" class="flex-grow-1 p-4" style="margin-left: 250px; transition: 0.3s;">
        <div class="content w-100 mb-3 ">
            <h2>Welcome {{admin.name}} to subjects page</h2>
            <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#addSubjectModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    style="fill: rgba(0, 0, 0, 1);">
                    <path
                        d="M6.012 18H21V4c0-1.103-.897-2-2-2H6c-1.206 0-3 .799-3 3v14c0 2.201 1.794 3 3 3h15v-2H6.012C5.55 19.988 5 19.806 5 19s.55-.988 1.012-1zM8 9h3V6h2v3h3v2h-3v3h-2v-3H8V9z">
                    </path>
                </svg><span class=" ms-2">Add Subject</span>
            </button>
        </div>

        <div class="content w-100">
            <div class="row g-3 justify-content-center">
                <!--Loop for Subject card-->
                {% if subjects|length == 0 %}
                <p class="text-center text-muted">No subjects available. Click <strong>"Add Subject"</strong> to create one.</p>
                {% else %}
                {% for subject in subjects%}
                <div class="col-md-6">
                    <div class="card shadow" style="width: 100;">
                        <div class="card-body">
                            <div class="row">
                                <h5 class="card-title col-md-9"><span class="fw-bold">Subject: </span>{{subject.name}}
                                </h5>
                                <button type="button" class="btn btn-outline-info ms-auto addChapterBtn col-md-3"
                                    data-bs-toggle="modal" data-bs-target="#addChapterModal" subjectId="{{subject.id}}"
                                    subjectName="{{subject.name}}">
                                    <span>Add Chapter</span>
                                </button>
                            </div>
                            <p class="card-text">{{subject.desc}}</p>
                            <div style="max-height: 250px; min-height: 250px; overflow-y: auto;">
                                {% if subject.chapters|length == 0 %}
                                <p class="text-center text-muted">No chapters available. Click <strong>"Add Chapter"</strong> to
                                    create one.</p>
                                {% else %}
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th scope="col" style="width: 5%">S.No.</th>
                                            <th scope="col" style="width: 35%">Chapter Name</th>
                                            <th scope="col" style="width: 30%">Quizzes</th>
                                            <th scope="col" style="width: 30%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!--Loop for chapters inside subject card-->
                                        {% for chapter in subject.chapters %}
                                        <tr>
                                            <th scope="row">{{loop.index}}</th>
                                            <td><span class="d-inline-block" tabindex="0" data-bs-toggle="popover"
                                                data-bs-trigger="hover focus" data-bs-content="{{chapter.desc}}">
                                                {{chapter.name}}
                                            </span></td>
                                            <!--Manage Quizzes Button-->
                                            <td>
                                                <a href="/{{subject.id}}/{{chapter.id}}/quizzes"
                                                    class="btn btn-outline-info ">
                                                    Manage Quizzes
                                                </a>
                                            </td>
                                            <td>
                                                <div class="row">
                                                    <!--Edit Chapter Button-->
                                                    <button class="btn btn-outline-dark  col editChapterBtn"
                                                        chapterId="{{chapter.id}}" chapterName="{{chapter.name}}"
                                                        chapterDesc="{{chapter.desc}}" editSubName="{{subject.name}}"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editChapterModal">Edit</button>
                                                    <!--Delete Chapter Button-->
                                                    <form action="/deleteChapter" method="POST" class="col"
                                                        onsubmit="return confirm('do you want to delete this chapter? This will delete all related data quizzes, questions, scores, etc.');">
                                                        <input type="hidden" name="id" value="{{ chapter.id }}">
                                                        <button type="submit"
                                                            class="btn btn-outline-danger col">Delete</button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>

                                        {% endfor %}
                                    </tbody>
                                </table>
                                {% endif %}
                            </div>
                            <div class="row m-1">
                                <!--Delete Subject Button-->
                                <form action="/deleteSubject" method="POST" class="col"
                                    onsubmit="return confirm('do you want to delete this subject? This will delete all related data chapters, quizzes, questions, etc.');">
                                    <input type="hidden" name="id" value="{{ subject.id }}">
                                    <button type="submit" class="btn btn-outline-danger w-100 ">Delete Subject</button>
                                </form>
                                <!--Edit Subject Button-->
                                <button class="btn btn-outline-dark  col editSubjectBtn" editSubjectId="{{subject.id}}"
                                    editSubjectName="{{subject.name}}" editSubjectDesc="{{subject.desc}}"
                                    data-bs-toggle="modal" data-bs-target="#editSubjectModal">Edit Subject</button>
                                <!--Add Chapter Button-->
                                <button type="button" class="btn btn-outline-info addChapterBtn col ms-2"
                                    data-bs-toggle="modal" data-bs-target="#addChapterModal" subjectId="{{subject.id}}"
                                    subjectName="{{subject.name}}">Add Chapter
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Modal Form for Adding Subject -->
    <div class="modal fade" id="addSubjectModal" tabindex="-1" aria-labelledby="addSubjectModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title fs-5" id="addSubjectModalLabel">New Subject</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addSubjectForm" action="/addSubject" method="POST">
                        <label for="name">Subject Name:</label>
                        <input type="text" id="name" name="name" required class="form-control">
                        <br>
                        <label for="desc">Description:</label>
                        <input type="text" id="desc" name="desc" required class="form-control">
                        <br>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-outline-success" form="addSubjectForm">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Form for Editing Subject -->
    <div class="modal fade" id="editSubjectModal" tabindex="-1" aria-labelledby="editSubjectModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title fs-5" id="editSubjectModalLabel">Edit Subject</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editSubjectForm" action="/editSubject" method="POST">
                        <input type="hidden" id="editSubjectId" name="id">
                        <label for="name">Subject Name:</label>
                        <input type="text" id="editSubjectName" name="name" required class="form-control">
                        <br>
                        <label for="desc">Description:</label>
                        <input type="text" id="editSubjectDesc" name="desc" required class="form-control">
                        <br>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-outline-success" form="editSubjectForm">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Form for Adding Chapters -->
    <div class="modal fade" id="addChapterModal" tabindex="-1" aria-labelledby="addChapterModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title fs-5" id="addChapterModalLabel">New Chapter</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="fw-bold fs-5 d-flex justify-content-center" id="subjectName"></p>
                    <form id="addChapterForm" action="/addChapter" method="POST">
                        <input type="hidden" name="subjectId" id="subjectId">
                        <label for="name">Chapter Name:</label>
                        <input type="text" id="name" name="name" required class="form-control">
                        <br>
                        <label for="desc">Description:</label>
                        <input type="text" id="desc" name="desc" required class="form-control">
                        <br>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-outline-success" form="addChapterForm">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Form for Editing Chapters -->
    <div class="modal fade" id="editChapterModal" tabindex="-1" aria-labelledby="editChapterModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title fs-5" id="editChapterModalLabel">Edit Chapter</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="fw-bold fs-5 d-flex justify-content-center" id="editSubName"></p>
                    <form id="editChapterForm" action="/editChapter" method="POST">
                        <input type="hidden" id="chapterId" name="id">
                        <label for="name">Chapter Name:</label>
                        <input type="text" id="editChapterName" name="name" required class="form-control">
                        <br>
                        <label for="desc">Description:</label>
                        <input type="text" id="editChapterDesc" name="desc" required class="form-control">
                        <br>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-outline-success" form="editChapterForm">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}